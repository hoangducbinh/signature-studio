<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tách nền chữ ký</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <link rel="icon" type="image/png" sizes="32x32" href="./src/images/favicon-32.png" />
  <link rel="icon" type="image/svg+xml" href="./src/images/icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="./src/images/apple-touch-icon.png" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="description" content="Công cụ tách nền & chỉnh sửa chữ ký online miễn phí. Tách nền chữ ký từ ảnh chụp, chỉnh nét và đổi màu." />
  <meta name="keywords" content="tách nền chữ ký, chỉnh sửa chữ ký, công cụ chữ ký online" />
  <meta name="author" content="hoangducbinh.prod" />
  <meta property="og:title" content="Tách nền chữ ký" />
  <meta property="og:description" content="Công cụ tách nền & chỉnh sửa chữ ký online miễn phí" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="#" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./src/styles.css" />
</head>
<body class="body-bg">
  <header class="container header">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 16c4-3 6-7 9-7 3 0 3 4 6 4 2 0 3-1 3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M3 20h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="brand-text">
        <h1 class="app-title">Signature Studio</h1>
        <p class="app-tagline">Tách nền, chỉnh nét & đổi màu chữ ký</p>
      </div>
    </div>
  </header>

  <main class="container main">
    <section class="layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="nav-group" aria-label="Điều hướng">
          <button class="nav-btn active" data-target="upload">
            <span class="nav-dot"></span><span>Tải ảnh</span>
          </button>
          <button class="nav-btn" data-target="settings">
            <span class="nav-dot"></span><span>Chỉnh sửa</span>
          </button>
        </nav>

        <div class="panel-group">
          <div id="panel-upload" class="panel card">
            <h3 class="subsection-title">Tải ảnh</h3>
            <div class="input-group">
              <label for="fileInput" class="file-label">Chọn ảnh chữ ký</label>
              <input id="fileInput" type="file" accept="image/*" />
              <p class="hint">Chụp trên giấy trắng, ánh sáng đều, nét ký đậm để có kết quả tốt. Phần mềm sẽ tự động tách nền khi bạn tải ảnh lên.</p>
              <div class="btn-row">
                <button id="resetBtn" class="btn btn-secondary">Làm mới</button>
              </div>
            </div>
          </div>

          <div id="panel-settings" class="panel card hidden">
            <h3 class="subsection-title">Chỉnh sửa</h3>
            <p class="hint">Điều chỉnh các thông số để có kết quả tốt nhất. Thay đổi sẽ được cập nhật realtime.</p>
            <div class="input-group">
              <div class="field">
                <div class="field-top">
                  <label class="label">Ngưỡng tách nền</label>
                  <input id="threshNum" type="number" value="128" min="0" max="255" step="1" class="number" />
                </div>
                <input id="thresh" type="range" min="0" max="255" value="128" />
                <div class="muted">Tăng nếu bị nhiễu ⟵ <span id="threshVal" class="bold">128</span> ⟶ Giảm nếu thiếu nét</div>
              </div>

              <div class="field">
                <div class="field-top">
                  <label class="label">Độ dày nét</label>
                  <input id="strokeNum" type="number" value="0" min="-5" max="5" step="0.5" class="number" />
                </div>
                <input id="stroke" type="range" min="-5" max="5" value="0" step="0.5" />
                <div class="muted">Làm mỏng ⟵ <span id="strokeVal" class="bold">0</span> ⟶ Làm đậm</div>
              </div>

              <div class="field">
                <div class="field-top">
                  <label class="label">Màu chữ ký</label>
                  <div class="color-stack">
                    <input id="color" type="color" value="#0000FF" class="color" />
                    <input id="colorHex" type="text" value="#0000FF" placeholder="#000000" maxlength="7" class="hex" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Xuất ảnh: 1 NÚT DUY NHẤT, luôn hiển thị -->
          <div class="card">
            <h3 class="subsection-title">Xuất ảnh</h3>
            <div class="input-group">
              <button id="exportBtn" class="btn btn-primary full">Xuất PNG</button>
            </div>
          </div>
        </div>
      </aside>

      <!-- Preview area -->
      <div class="stage">
        <div class="canvas-wrap card">
          <div class="canvas-header">
            <div class="canvas-title" id="canvasTitle">Tải ảnh chữ ký</div>
            <div class="canvas-controls hidden" id="canvasControls">
              <button class="canvas-btn active" id="showResult" title="Xem kết quả">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                Kết quả
              </button>
              <button class="canvas-btn" id="showOriginal" title="Xem ảnh gốc">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                  <circle cx="9" cy="9" r="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M21 15l-3.086-3.086a2 2 0 00-2.828 0L6 21" stroke="currentColor" stroke-width="2"/>
                </svg>
                Gốc
              </button>
            </div>
          </div>
          <div class="canvas-body checker">
            <!-- Upload prompt (shown when no image) -->
            <div class="upload-prompt" id="uploadPrompt">
              <div class="upload-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h3>Tải ảnh chữ ký</h3>
              <p>Nhấn nút "Chọn ảnh chữ ký" bên trái hoặc kéo thả ảnh vào đây</p>
              <div class="upload-formats">PNG, JPG, WEBP</div>
            </div>
            
            <!-- Canvas for displaying images -->
            <canvas id="mainCanvas" class="hidden"></canvas>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="loadingModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Đang xử lý ảnh">
    <div class="modal-content">
      <div class="loader" aria-hidden="true"></div>
      <p class="loading-text">Đang xử lý ảnh...</p>
    </div>
  </div>

  <script src="./src/main.js"></script>
</body>
</html>